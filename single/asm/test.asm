# MIPS CPU 完整测试程序
# 使用所有支持的指令：R-type + lw/sw + beq + j

.text
main:
    # ============================================
    # 阶段1：生成第一个非0值（从0生成1）
    # ============================================
    nor $t0, $zero, $zero    # $t0 = 0xFFFFFFFF
    
    srl $t1, $t0, 31         # $t1 = 1 (0xFFFFFFFF >> 31)
    
    # ============================================
    # 阶段2：测试内存指令
    # ============================================
    sw $t1, 0($zero)         # mem[0] = 1
    
    lw $t2, 0($zero)         # $t2 = 1
    
    # ============================================
    # 阶段3：测试R-type算术运算
    # ============================================
    add $t3, $t2, $t2        # $t3 = 2 (测试add)
    addu $t4, $t3, $t2       # $t4 = 3 (测试addu)
    
    sub $t5, $t4, $t2        # $t5 = 2 (测试sub) 
    subu $t6, $t4, $t3       # $t6 = 1 (测试subu)
    
    sw $t3, 4($zero)         # mem[4] = 2
    sw $t4, 8($zero)         # mem[8] = 3
    
    # ============================================
    # 阶段4：测试R-type逻辑运算
    # ============================================
    and $t7, $t3, $t4        # $t7 = 2 & 3 = 2
    or $t8, $t3, $t4         # $t8 = 2 | 3 = 3
    xor $t9, $t3, $t4        # $t9 = 2 ^ 3 = 1
    nor $s0, $t3, $t4        # $s0 = ~(2|3)
    
    # ============================================
    # 阶段5：测试R-type移位运算
    # ============================================
    sll $s1, $t2, 2          # $s1 = 1 << 2 = 4
    srl $s2, $s0, 2          # $s2 = 算术右移测试
    
    # ============================================
    # 阶段6：测试R-type比较运算
    # ============================================
    slt $s5, $t2, $t3        # $s5 = 1 (1 < 2)
    sltu $s6, $t2, $t3       # $s6 = 1 (1 < 2)
    
    # ============================================
    # 阶段7：测试分支指令beq
    # ============================================
    beq $t2, $t2, branch_test1
    add $a0, $zero, $zero    # 这行应该跳过
    
branch_test1:
    lw $a1, 4($zero)         # $a1 = 2
    
    beq $t2, $t3, should_not_jump
    add $a2, $t2, $t2        # $a2 = 2 (应该执行)
    
should_not_jump:
    # ============================================
    # 阶段8：测试跳转指令j
    # ============================================
    j jump_test
    add $a3, $zero, $zero    # 这行应该跳过
    
jump_test:
    add $t0, $t0, $zero      # 空操作
    
    # ============================================
    # 阶段9：最终验证
    # ============================================
    lw $k0, 0($zero)         # $k0 = 1
    lw $k1, 4($zero)         # $k1 = 2
    
    add $at, $k0, $k1        # $at = 3
    beq $at, $t4, success    # 如果$at == 3，成功
    
fail_loop:
    j fail_loop              # 失败循环
    
success:
    sw $k0, 12($zero)        # mem[12] = 1 表示成功
    
end_loop:
    j end_loop               # 成功结束循环